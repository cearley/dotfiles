{{- $fullname := promptStringOnce . "fullname" "Your full name" -}}
{{- $gh_username := promptStringOnce . "gh_username" "GitHub user name" (env "GITHUB_USERNAME") -}}

{{- $computed_gh_commit_email := cat $gh_username "@users.noreply.github.com" | nospace -}}
{{- $gh_commit_email_default := promptStringOnce . "gh_commit_email" "GitHub commit email address (Default)" $computed_gh_commit_email -}}
{{- $gh_commit_email_primary_work := promptStringOnce . "gh_commit_email_primary_work" "GitHub commit email address (Primary work)" -}}
{{- $microsoft_email := promptStringOnce . "microsoft_email" "Microsoft email address (optional, press enter to skip)" "" -}}

{{- /* GitHub Packages configuration (all optional) */ -}}
{{- $gh_packages_owner := promptStringOnce . "gh_packages_owner" "GitHub Packages owner/org (optional, press enter to skip all package managers)" "" -}}
{{- $gh_npm_registry := "" -}}
{{- $gh_nuget_source := "" -}}
{{- $gh_maven_repository := "" -}}
{{- $gh_pip_index := "" -}}
{{- if ne $gh_packages_owner "" -}}
{{-   $gh_npm_registry = promptStringOnce . "gh_npm_registry" "npm registry URL (optional, e.g., npm.pkg.github.com)" "" -}}
{{-   $gh_nuget_source = promptStringOnce . "gh_nuget_source" "NuGet source URL (optional)" "" -}}
{{-   $gh_maven_repository = promptStringOnce . "gh_maven_repository" "Maven repository URL (optional)" "" -}}
{{-   $gh_pip_index = promptStringOnce . "gh_pip_index" "pip index URL (optional)" "" -}}
{{- end -}}

{{- $aws_secrets_manager_profile := promptStringOnce . "aws_secrets_manager_profile" "AWS Secrets Manager profile name" "default" -}}
{{- $aws_secrets_manager_region := promptStringOnce . "aws_secrets_manager_region" "AWS Secrets Manager region" "us-east-1" -}}
{{- $keepassxc_db := promptStringOnce . "keepassxc_db" "keepassxc database (Absolute path - Can be provided later)" -}}

{{- $tag_choices := list "ai" "datascience" "dev" "mobile" "personal" "work" -}}
{{- $tags := promptMultichoiceOnce . "tags" "list of tags for this machine (e.g., ai, mobile, work)"
    $tag_choices (list "work")
-}}

[data]
aws_secrets_manager_profile = {{ $aws_secrets_manager_profile | quote }}
aws_secrets_manager_region = {{ $aws_secrets_manager_region | quote }}
fullname = {{ $fullname | quote }}
gh_commit_email = {{ $gh_commit_email_default | quote }}
gh_commit_email_primary_work = {{ $gh_commit_email_primary_work | quote }}
gh_username = {{ $gh_username | quote }}
gh_packages_owner = {{ $gh_packages_owner | quote }}
gh_npm_registry = {{ $gh_npm_registry | quote }}
gh_nuget_source = {{ $gh_nuget_source | quote }}
gh_maven_repository = {{ $gh_maven_repository | quote }}
gh_pip_index = {{ $gh_pip_index | quote }}
keepassxc_db = {{ $keepassxc_db | quote }}
has_keepassxc_db = {{ if and (ne $keepassxc_db "") (stat $keepassxc_db) }}true{{ else }}false{{ end }}
microsoft_email = {{ $microsoft_email | quote }}
tags = {{ $tags | toToml }}
tag_choices = {{ $tag_choices | toToml }}

[scriptEnv]
GITHUB_USERNAME = {{ $gh_username | quote }}

[awsSecretsManager]
profile = {{ $aws_secrets_manager_profile | quote }}
region = {{ $aws_secrets_manager_region | quote }}

[keepassxc]
database = {{ $keepassxc_db | quote }}

[hooks.read-source-state.pre]
command = ".local/share/chezmoi/hooks/pre/bootstrap"

{{ if lookPath "code" -}}
[edit]
command = "code"
args = ["--wait"]

[diff]
exclude = ["scripts"]
command = "code"
args = ["--wait", "--diff"]

[merge]
command = "bash"
args = [
    "-c",
    "cp {{ "{{" }} .Target | quote {{ "}}" }} {{ "{{" }} .Target | quote {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination | quote {{ "}}" }} {{ "{{" }} .Target | quote {{ "}}" }} {{ "{{" }} .Target | quote {{ "}}" }}.base {{ "{{" }} .Source | quote {{ "}}" }}"
]
{{- end }}
