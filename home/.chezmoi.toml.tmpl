{{- $fullname := promptStringOnce . "fullname" "Your full name" -}}
{{- $gh_username := promptStringOnce . "gh_username" "GitHub user name" -}}

{{- $computed_gh_commit_email := cat $gh_username "@users.noreply.github.com" | nospace -}}
{{- $gh_commit_email_default := promptStringOnce . "gh_commit_email" "GitHub commit email address (Default)" $computed_gh_commit_email -}}
{{- $gh_commit_email_primary_work := promptStringOnce . "gh_commit_email_primary_work" "GitHub commit email address (Primary work)" -}}
{{- $microsoft_email := promptStringOnce . "microsoft_email" "Microsoft email address (optional, press enter to skip)" "" -}}

{{- $aws_secrets_manager_profile := promptStringOnce . "aws_secrets_manager_profile" "AWS Secrets Manager profile name" "default" -}}
{{- $aws_secrets_manager_region := promptStringOnce . "aws_secrets_manager_region" "AWS Secrets Manager region" "us-east-1" -}}
{{- $keepassxc_db := promptStringOnce . "keepassxc_db" "keepassxc database (Absolute path - Can be provided later)" -}}

{{- $tag_choices := list "ai" "datascience" "dev" "ml" "mobile" "personal" "work" -}}
{{- $tags := promptMultichoiceOnce . "tags" "list of tags for this machine (e.g., ai, mobile, work)"
    $tag_choices (list "work")
-}}

[data]
aws_secrets_manager_profile = {{ $aws_secrets_manager_profile | quote }}
aws_secrets_manager_region = {{ $aws_secrets_manager_region | quote }}
fullname = {{ $fullname | quote }}
gh_commit_email = {{ $gh_commit_email_default | quote }}
gh_commit_email_primary_work = {{ $gh_commit_email_primary_work | quote }}
gh_username = {{ $gh_username | quote }}
keepassxc_db = {{ $keepassxc_db | quote }}
has_keepassxc_db = {{ if and (ne $keepassxc_db "") (stat $keepassxc_db) }}true{{ else }}false{{ end }}
microsoft_email = {{ $microsoft_email | quote }}
tags = {{ $tags | toToml }}

[scriptEnv]
GITHUB_USERNAME = {{ $gh_username | quote }}

[awsSecretsManager]
profile = {{ $aws_secrets_manager_profile | quote }}
region = {{ $aws_secrets_manager_region | quote }}

[keepassxc]
database = {{ $keepassxc_db | quote }}

[hooks.read-source-state.pre]
command = ".local/share/chezmoi/hooks/pre/bootstrap"

{{ if lookPath "code" -}}
[edit]
command = "code"
args = ["--wait"]

[diff]
exclude = ["scripts"]
command = "code"
args = ["--wait", "--diff"]

[merge]
command = "bash"
args = [
    "-c",
    "cp {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination {{ "}}" }} {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base {{ "{{" }} .Source {{ "}}" }}"
]
{{- end }}
