{{- if and (eq .chezmoi.os "darwin") (has "ai" .tags) -}}
#!/bin/bash

set -eufo pipefail

# Source shared utility functions
source "{{ .chezmoi.sourceDir -}}/scripts/script-utils.sh"

# Check if Claude Desktop is already installed
if is_app_installed "/Applications/Claude.app"; then
    print_message "skip" "Skipping Claude Desktop installation: Claude Desktop is already installed"
    exit 0
fi

print_message "info" "Setting up Claude Desktop App..."

# Open the Claude Desktop download page
print_message "info" "Opening Claude Desktop download page in your default browser..."
open "https://claude.ai/download"

echo ""
print_message "info" "Manual Installation Instructions:"
echo "1. Click 'Download for Mac' on the page that just opened"
echo "2. Once downloaded, open the downloaded .dmg file"
echo "3. Drag Claude.app to your Applications folder"
echo "4. After installation, launch Claude from your Applications folder"
echo "5. Sign in with your Anthropic account or create one if needed"
echo ""

# Wait a moment for the page to load, then provide additional guidance
sleep 3

print_message "info" "Additional Setup Tips:"
echo "- Claude Desktop may request permissions for notifications and accessibility"
echo "- You can manage permissions in System Preferences > Security & Privacy"
echo "- Claude Desktop works best when allowed to run in the background"
echo "- You can pin Claude to your Dock for easy access"
echo ""

# Wait for the user to complete the installation
if wait_for_app_installation "/Applications/Claude.app" "Claude Desktop"; then
    print_message "info" "You can now launch Claude from your Applications folder"
    print_message "info" "Sign in with your Anthropic account to start using Claude Desktop"
else
    print_message "info" "Claude Desktop can be manually installed from: https://claude.ai/download"
    exit 1
fi

{{ end -}}