{{- if and (eq .chezmoi.os "darwin") (has "dev" .tags) -}}
#!/bin/bash

set -euo pipefail

source "{{ .chezmoi.sourceDir -}}/scripts/shared-utils.sh"

if ! require_tools curl zip unzip; then
    exit 1
fi

if [[ -d "$HOME/.sdkman" ]] && [[ -f "$HOME/.sdkman/bin/sdkman-init.sh" ]]; then
    print_message "info" "sdkman is already installed. Updating..."
    set +u  # disable nounset; sdkman scripts reference unbound variables (e.g., ZSH_VERSION)
    source "$HOME/.sdkman/bin/sdkman-init.sh"
    sdk update
    set -u  # re-enable nounset
    exit 0
fi

print_message "info" "Installing sdkman (Software Development Kit Manager)..."

# Install sdkman using the official installation script from sdkman.io
export SDKMAN_DIR="$HOME/.sdkman"
curl -s "https://get.sdkman.io" | bash

print_message "success" "sdkman installed successfully!"
print_message "info" "sdkman installed to: $SDKMAN_DIR. You may need to restart your terminal to start using it."

{{ end -}}