{{- if and (eq .chezmoi.os "darwin") (has "ai" .tags) -}}
#!/bin/bash

# Install Basic Memory MCP server for Claude Desktop
# Prerequisite: uv (installed by run_once_before_darwin-15-install-uv.sh.tmpl)

# Source shared utility functions
source "{{ .chezmoi.sourceDir -}}/scripts/script-utils.sh"

# Check required tools
if ! require_tools curl uvx; then
    exit 1
fi

# Skip if basic-memory is already installed.
if uvx basic-memory --version >/dev/null 2>&1; then
    print_message "skip" "Skipping basic-memory installation: basic-memory is already installed"
    exit 0
fi

print_message "info" "Installing Basic Memory MCP server for Claude Desktop..."

# Install Basic Memory via the recommended installer
# This will install uv (if not already installed), install Basic Memory via uv,
# and configure Claude Desktop automatically with user permission.
curl -LsSf https://basicmemory.com/install/latest.sh | sh

print_message "success" "Basic Memory MCP server installation completed"
{{ end -}}