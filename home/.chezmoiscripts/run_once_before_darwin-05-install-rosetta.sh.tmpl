{{- if and (eq .chezmoi.os "darwin") (eq .chezmoi.arch "arm64") -}}
#!/bin/bash

# Source shared utility functions
source "{{ .chezmoi.sourceDir -}}/scripts/script-utils.sh"

if /usr/bin/pgrep oahd >/dev/null 2>&1; then
    print_message "skip" "Skipping Rosetta installation: Rosetta is already installed"
    exit 0
fi

print_message "info" "Installing Rosetta on Apple Silicon Mac..."

sudo softwareupdate --install-rosetta --agree-to-license
if [ $? -ne 0 ]; then
    print_message "error" "Rosetta installation failed"
    exit 1
fi

print_message "success" "Rosetta installation completed successfully"

{{ end -}}