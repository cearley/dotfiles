{{- if and (eq .chezmoi.os "darwin") .microsoft_email -}}
#!/bin/bash

set -eufo pipefail

echo "ðŸ›¡ï¸  Setting up Microsoft Defender for Individuals..."

# Check if Microsoft Defender is already installed
if [ -d "/Applications/Microsoft Defender.app" ]; then
    echo "âœ… Microsoft Defender is already installed"
    exit 0
fi

# Open the Microsoft Defender download page
echo "Opening Microsoft Defender download page in your default browser..."
open "https://www.microsoft.com/en-us/microsoft-365/microsoft-defender-for-individuals#Download-the-app"

echo ""
echo "ðŸ“‹ Manual Installation Instructions:"
echo "1. Click 'Download for MacOS' on the page that just opened"
echo "2. Once downloaded, open the installer package"
echo "3. Follow the installation wizard to install Microsoft Defender"
echo "4. After installation, launch Microsoft Defender"
echo "5. Sign in with your Microsoft account: {{ .microsoft_email }}"
echo ""

# Wait a moment for the page to load, then provide additional guidance
sleep 3

echo "ðŸ’¡ Additional Setup Tips:"
echo "- Microsoft Defender may require Full Disk Access permissions"
echo "- You can grant permissions in System Preferences > Security & Privacy > Privacy > Full Disk Access"
echo "- Add Microsoft Defender to the list of allowed applications"
echo ""
echo "âœ… Once installation is complete, Microsoft Defender will provide real-time protection for your Mac"

{{ end -}}